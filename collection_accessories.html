<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessories | Nightmare Racing</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family:Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="indexStyles.css">
    <link rel="stylesheet" href="navStyles.css">
    <link rel="stylesheet" href="shopParts.css">
    <link rel="stylesheet" href="footer.css">
    <style>
        body { background: #0a0a0a !important; }
        #bg-video { display: none !important; }
        .collection-page { background: #0a0a0a; min-height: 100vh; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html"><img src="pictures/logoImage1.png" alt="Nightmare Racing Logo"></a>
                <h2>NIGHTMARE<span class="text-accent">RACING</span></h2>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#services">Services</a></li>
                <li><a href="featured-cars.html">Featured Cars</a></li>
                <li><a href="shopParts.html" class="active">Shop Parts</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
            <div class="nav-actions">
                <a href="/admin" target="_blank" class="admin-btn">Admin</a>
            </div>
            <div class="hamburger"><span></span><span></span><span></span></div>
        </div>
    </nav>
    <div class="mobile-menu-overlay"></div>
    <div class="mobile-menu">
        <div class="mobile-menu-content">
            <div class="mobile-menu-header">
                <h2>NIGHTMARE<span class="text-accent">RACING</span></h2>
                <button class="mobile-menu-close">&times;</button>
            </div>
            <ul class="mobile-nav-links">
                <li><a href="/admin" target="_blank">Admin Portal</a></li>
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#services">Services</a></li>
                <li><a href="featured-cars.html">Featured Cars</a></li>
                <li><a href="shopParts.html" class="active">Shop Parts</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
            <div class="mobile-menu-footer">
                <p>© 2025 Nightmare Racing</p>
                <p>Premium Auto Services</p>
            </div>
        </div>
    </div>
    <section class="collection-page shop-parts-page">
        <div class="container">
            <div class="page-header">
                <h1><span class="text-accent">ACCESSORIES</span></h1>
                <p>Premium automotive accessories and upgrades</p>
            </div>
            <div class="collections-quick-links" style="margin-bottom: 3rem;">
                <div class="section-header" style="margin-bottom: 2rem;">
                    <h2>Browse Other <span class="text-accent">Collections</span></h2>
                </div>
                <ul class="collections-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; list-style: none; padding: 0;">
                    <li style="padding-left: 0;"><a href="collection-bearings.html" style="color: #fff; text-decoration: none;">Bearings</a></li>
                    <li style="padding-left: 0;"><a href="collection-merchandise.html" style="color: #fff; text-decoration: none;">Merchandise</a></li>
                    <li style="padding-left: 0;"><a href="collection-exhaust.html" style="color: #fff; text-decoration: none;">Exhaust</a></li>
                    <li style="padding-left: 0;"><a href="collection-suspension.html" style="color: #fff; text-decoration: none;">Suspension</a></li>
                    <li style="padding-left: 0;"><a href="collection-engine.html" style="color: #fff; text-decoration: none;">Engine</a></li>
                    <li style="padding-left: 0;"><a href="shopParts.html" style="color: #e50000; font-weight: bold;">View All Collections →</a></li>
                </ul>
            </div>
            <div id="products-loading" class="loading-state">
                <div class="spinner"></div>
                <p>Loading products...</p>
            </div>
            <div id="products-grid" class="products-grid hidden"></div>
            <div class="load-more-section hidden" id="load-more-section">
                <button class="btn-primary" id="load-more-btn">Load More Products</button>
            </div>
        </div>
    </section>
    <div id="footer-section"></div>
    <script>
        async function loadFooter() {
            try {
                const response = await fetch('footer.html');
                const html = await response.text();
                document.getElementById('footer-section').innerHTML = html;
            } catch (error) {
                console.error('Error loading footer:', error);
            }
        }
        loadFooter();
    </script>
    <script src="index.js"></script>
    <script>
        const COLLECTION_HANDLE = 'shop-accessories';
        const SHOPIFY_DOMAIN = 'nightmareracing.myshopify.com';
        const STOREFRONT_ACCESS_TOKEN = '01ebdb40d541cc7fda967406889dc1b4';
        const STOREFRONT_API_VERSION = '2024-01';
        const COLLECTION_PRODUCTS_QUERY = `query GetCollectionProducts($handle: String!, $first: Int!, $after: String) { collection(handle: $handle) { title description products(first: $first, after: $after) { pageInfo { hasNextPage endCursor } edges { node { id title description handle priceRange { minVariantPrice { amount currencyCode } } images(first: 1) { edges { node { url altText } } } variants(first: 1) { edges { node { id availableForSale } } } } } } } }`;
        let productsData = [];
        let productsEndCursor = null;
        let hasNextPage = false;
        async function shopifyStorefrontAPI(query, variables = {}) {
            const response = await fetch(`https://${SHOPIFY_DOMAIN}/api/${STOREFRONT_API_VERSION}/graphql.json`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-Shopify-Storefront-Access-Token': STOREFRONT_ACCESS_TOKEN },
                body: JSON.stringify({ query, variables })
            });
            const data = await response.json();
            if (data.errors) throw new Error(data.errors[0].message);
            return data.data;
        }
        function formatPrice(amount, currencyCode) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: currencyCode }).format(amount);
        }
        window.viewProduct = function(handle) {
            window.open(`https://${SHOPIFY_DOMAIN}/products/${handle}`, '_blank');
        };
        async function loadCollectionProducts(loadMore = false) {
            try {
                const variables = { handle: COLLECTION_HANDLE, first: 20, after: loadMore ? productsEndCursor : null };
                const data = await shopifyStorefrontAPI(COLLECTION_PRODUCTS_QUERY, variables);
                if (!data.collection) throw new Error('Collection not found');
                if (!loadMore) productsData = [];
                productsData.push(...data.collection.products.edges.map(edge => edge.node));
                productsEndCursor = data.collection.products.pageInfo.endCursor;
                hasNextPage = data.collection.products.pageInfo.hasNextPage;
                displayProducts();
                document.getElementById('products-loading').classList.add('hidden');
                document.getElementById('products-grid').classList.remove('hidden');
                const loadMoreSection = document.getElementById('load-more-section');
                if (loadMoreSection) {
                    hasNextPage ? loadMoreSection.classList.remove('hidden') : loadMoreSection.classList.add('hidden');
                }
            } catch (error) {
                console.error('Error loading collection products:', error);
                document.getElementById('products-loading').innerHTML = '<p class="error">Failed to load products. Please try again later.</p>';
            }
        }
        function displayProducts() {
            const grid = document.getElementById('products-grid');
            if (!grid) return;
            grid.innerHTML = '';
            productsData.forEach(product => grid.appendChild(createProductCard(product)));
        }
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            const imageUrl = product.images.edges[0]?.node.url || 'https://via.placeholder.com/300x300/0a0a0a/e50000?text=No+Image';
            const price = formatPrice(product.priceRange.minVariantPrice.amount, product.priceRange.minVariantPrice.currencyCode);
            const isAvailable = product.variants.edges[0]?.node.availableForSale ?? true;
            card.innerHTML = `<div class="product-image"><img src="${imageUrl}" alt="${product.title}">${!isAvailable ? '<div class="sold-out-badge">Sold Out</div>' : ''}</div><div class="product-info"><h3>${product.title}</h3><div class="product-price">${price}</div><button class="btn-view-product" onclick="viewProduct('${product.handle}')" ${!isAvailable ? 'disabled' : ''}>${isAvailable ? 'View Product' : 'Out of Stock'}</button></div>`;
            return card;
        }
        const loadMoreBtn = document.getElementById('load-more-btn');
        if (loadMoreBtn) loadMoreBtn.addEventListener('click', () => loadCollectionProducts(true));
        document.addEventListener('DOMContentLoaded', () => loadCollectionProducts());
    </script>
</body>
</html>