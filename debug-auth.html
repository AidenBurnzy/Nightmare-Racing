<!DOCTYPE html>
<html>
<head>
    <title>Auth Debug - Nightmare Racing</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a1a; 
            color: white; 
            padding: 20px; 
        }
        .status { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 5px; 
        }
        .success { background: #004d00; }
        .error { background: #4d0000; }
        .info { background: #003d4d; }
        .warning { background: #4d3d00; }
    </style>
</head>
<body>
    <h1>Nightmare Racing - Authentication Debug</h1>
    <div id="debug-output"></div>
    
    <script>
        const output = document.getElementById('debug-output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            output.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // Check if script loaded
        log('üîÑ Starting authentication debug...', 'info');
        
        // Check if Netlify Identity widget loaded
        setTimeout(() => {
            if (typeof window.netlifyIdentity === 'undefined') {
                log('‚ùå Netlify Identity widget did NOT load', 'error');
                log('This could be due to:', 'warning');
                log('‚Ä¢ Script blocked by browser/adblocker', 'warning');
                log('‚Ä¢ Network connectivity issues', 'warning');
                log('‚Ä¢ CORS/security policy blocking the script', 'warning');
            } else {
                log('‚úÖ Netlify Identity widget loaded successfully', 'success');
                
                // Try to initialize
                try {
                    log('üîÑ Attempting to initialize Netlify Identity...', 'info');
                    
                    window.netlifyIdentity.on('init', (user) => {
                        log(`‚úÖ Identity initialized. User: ${user ? user.email : 'None'}`, 'success');
                    });
                    
                    window.netlifyIdentity.on('error', (err) => {
                        log(`‚ùå Identity error: ${err.message}`, 'error');
                    });
                    
                    window.netlifyIdentity.init();
                    log('üîÑ Init() called successfully', 'info');
                    
                } catch (error) {
                    log(`‚ùå Error during initialization: ${error.message}`, 'error');
                }
            }
        }, 1000);
        
        // Check current URL and site info
        log(`üåê Current URL: ${window.location.href}`, 'info');
        log(`üåê Origin: ${window.location.origin}`, 'info');
        log(`üåê Host: ${window.location.host}`, 'info');
        
        // Check if we're on Netlify
        if (window.location.host.includes('netlify.app')) {
            log('‚úÖ Running on Netlify domain', 'success');
        } else if (window.location.host.includes('localhost')) {
            log('‚ö†Ô∏è Running on localhost - Identity may not work locally', 'warning');
        } else {
            log('‚ÑπÔ∏è Running on custom domain', 'info');
        }
        
        // Manual test button
        setTimeout(() => {
            const testBtn = document.createElement('button');
            testBtn.textContent = 'Test Manual Login';
            testBtn.style.cssText = 'padding: 10px 20px; margin: 20px 0; background: #e50000; color: white; border: none; border-radius: 5px; cursor: pointer;';
            testBtn.onclick = () => {
                try {
                    if (window.netlifyIdentity) {
                        log('üîÑ Attempting to open login modal...', 'info');
                        window.netlifyIdentity.open();
                    } else {
                        log('‚ùå Cannot test - netlifyIdentity not available', 'error');
                    }
                } catch (error) {
                    log(`‚ùå Login test failed: ${error.message}`, 'error');
                }
            };
            output.appendChild(testBtn);
        }, 2000);
    </script>
</body>
</html>